<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Postes para Windsock</title>

<style>
    body { font-family: Arial; padding: 20px; background: #eef2f3; }
    .card {
        max-width: 900px; margin: auto; padding: 20px; background: white;
        border-radius: 8px; box-shadow: 0 0 10px #0002;
    }
    h2 { margin-top: 0; }
    label { display: block; margin-top: 10px; }
    select, input {
        width: 100%; padding: 8px; margin-top: 3px; border: 1px solid #aaa;
        border-radius: 5px;
    }
    .tramo {
        border: 1px solid #ddd; padding: 8px; margin: 10px 0; border-radius: 5px;
        background: #fafafa; position: relative;
    }
    .delete-btn {
        position: absolute; right: 8px; top: 8px;
        background: red; color: white; border: none;
        padding: 3px 6px; cursor: pointer; font-size: 12px;
    }
    button {
        width: 100%; padding: 12px; margin-top: 20px; font-size: 16px;
        background: #0074d9; color: white; border: none; border-radius: 5px;
        cursor: pointer;
    }
    button:hover { background: #0057a3; }
    .resultado {
        margin-top: 20px; padding: 15px; background: #e2ffe2;
        border-radius: 8px; border: 1px solid #7fc27f;
        display: none;
    }
</style>
</head>

<body>
<div class="card">
    <h2>Calculadora de Postes de Windsock</h2>

    <label>1️⃣ Selecciona los tramos del poste (puedes combinar):</label>
    <div id="tramos"></div>
    <button onclick="agregarTramo()">➕ Agregar tramo</button>

    <label>2️⃣ Ubicación (trae velocidad V10m automáticamente):</label>
    <select id="ubicacion"></select>

    <label>3️⃣ Selecciona Alpha (rugosidad del terreno):</label>
    <select id="alpha">
        <option value="0.10">0.10 - Superficie lisa</option>
        <option value="0.14">0.14 - Campo abierto</option>
        <option value="0.22">0.22 - Suburbano</option>
        <option value="0.28">0.28 - Urbano</option>
    </select>

    <label>4️⃣ Diámetro de la manga (pulgadas):</label>
    <select id="diamManga">
        <option value="8">8"</option>
        <option value="13">13"</option>
        <option value="18">18"</option>
        <option value="20">20"</option>
        <option value="24">24"</option>
        <option value="36">36"</option>
    </select>

    <label>5️⃣ Longitud de la manga (pulgadas):</label>
    <input type="number" id="largoManga" placeholder="Ej: 96">

    <label>6️⃣ Tipo de soporte:</label>
    <select id="soporte">
        <option value="aro">Aro giratorio</option>
        <option value="canastilla">Canastilla extendida</option>
    </select>

    <label>7️⃣ Factor de seguridad:</label>
    <input type="number" id="FS" step="0.1" value="1.5">

    <button onclick="calcular()">✅ Calcular</button>

    <div class="resultado" id="resultado"></div>
</div>

<script>

// Tabla V10m por ubicación
const tablaViento = {
    "Lima": 7.5,
    "Arequipa": 9.2,
    "Piura": 10.8,
    "Cusco": 6.0,
    "Puno": 11.0
};

// Extensión de canastilla según diámetro de manga
const extensiones = {
    "8": 0.40, "13": 0.50, "18": 0.60,
    "20": 0.65, "24": 0.70, "36": 0.90
};

// Propiedades cédula 40 (OD en metros, espesor en m, peso kg/m, módulo E)
const tuberias = {
    "1":  { OD: 0.0334, esp: 0.00338, kgm: 2.5 },
    "2":  { OD: 0.0603, esp: 0.00391, kgm: 5.4 },
    "3":  { OD: 0.0889, esp: 0.00549, kgm: 7.5 },
    "4":  { OD: 0.1143, esp: 0.00602, kgm: 10.8 }
};

const E = 200e9; // Módulo de elasticidad del acero (Pa)

// inicializa ubicaciones
window.onload = () => {
    let ub = document.getElementById("ubicacion");
    for (let key in tablaViento) {
        let opt = document.createElement("option");
        opt.value = key;
        opt.textContent = key;
        ub.appendChild(opt);
    }
    agregarTramo();
};

function agregarTramo() {
    let cont = document.createElement("div");
    cont.className = "tramo";
    cont.innerHTML = `
        <button class="delete-btn" onclick="this.parentNode.remove()">X</button>
        <label>Longitud del tramo (m):</label>
        <input type="number" step="0.1" placeholder="Ej: 2.5" class="len">
        <label>Diámetro:</label>
        <select class="diam">
            <option value="1">1"</option>
            <option value="2">2"</option>
            <option value="3">3"</option>
            <option value="4">4"</option>
        </select>
    `;
    document.getElementById("tramos").appendChild(cont);
}

function calcular() {

    let tramos = document.querySelectorAll("#tramos .tramo");
    if (tramos.length === 0) {
        alert("Debe agregar al menos un tramo");
        return;
    }

    let H = 0;  // altura total
    let peso = 0;
    let momentoPeso = 0;
    let deflexion = 0;

    // Datos generales
    let ubicacion = document.getElementById("ubicacion").value;
    let V10 = tablaViento[ubicacion];
    let alpha = parseFloat(document.getElementById("alpha").value);

    let Dm = parseFloat(document.getElementById("diamManga").value) * 0.0254; // a metros
    let Lm = parseFloat(document.getElementById("largoManga").value) * 0.0254; // pulgadas a metros
    let FS = parseFloat(document.getElementById("FS").value);

    // recorre tramos para obtener altura y momentos de peso
    let acumulado = 0;
    tramos.forEach(t => {
        let len = parseFloat(t.querySelector(".len").value);
        let d   = t.querySelector(".diam").value;
        if (!len) return;

        acumulado += len;
        H = acumulado;

        // peso total
        peso += tuberias[d].kgm * len;

        // momento por peso (centro del tramo)
        let brazo = acumulado - len/2;
        momentoPeso += tuberias[d].kgm * 9.81 * len * brazo;
    });

    // velocidad a la altura
    let Vh = V10 * Math.pow((H/10), alpha);

    // presión dinámica q = 0.613 V^2
    let q = 0.613 * Math.pow(Vh, 2);

    // área proyectada de la manga
    let A = Dm * Lm;

    // fuerza total con FS
    let Fd = q * A * FS;

    // momento por viento
    let Mv = Fd * (H/2);

    // deflexión por viento: suma por tramos
    // para cada tramo: δ = F * L^3 / (3 E I)
    let alturaAcum = 0;
    tramos.forEach(t => {
        let len = parseFloat(t.querySelector(".len").value);
        let d   = t.querySelector(".diam").value;
        if (!len) return;

        // momento de inercia tubo circular:
        // I = (pi/64) * (OD^4 - ID^4)
        let OD = tuberias[d].OD;
        let ID = OD - 2*tuberias[d].esp;
        let I = (Math.PI / 64) * (Math.pow(OD,4) - Math.pow(ID,4));

        // altura total sobre el que actúa el viento, viga cantiléver
        alturaAcum += len;
        deflexion += (Fd * Math.pow(alturaAcum, 3)) / (3 * E * I);
    });

    // verificación aro/canastilla
    let soporte = document.getElementById("soporte").value;
    let condicionOK = true;
    let mensajeVerificacion = "";

    if (soporte === "aro") {
        if (H <= (Lm + 1.5)) {
            condicionOK = false;
            mensajeVerificacion = "⚠ Debe ser mayor a largo + 1.5 m para aro";
        }
    } else {
        let Lext = extensiones[String(parseInt(document.getElementById("diamManga").value))];
        if (H <= (Lm + 1.5 - Lext)) {
            condicionOK = false;
            mensajeVerificacion = "⚠ Altura insuficiente para canastilla extendida";
        }
    }

    document.getElementById("resultado").style.display = "block";
    document.getElementById("resultado").innerHTML = `
        <b>Resultados:</b><br><br>
        Altura total: <b>${H.toFixed(2)} m</b><br>
        Velocidad a la altura: <b>${Vh.toFixed(2)} m/s</b><br>
        Fuerza total sobre manga (con FS): <b>${Fd.toFixed(2)} N</b><br>
        Momento total en base: <b>${(momentoPeso + Mv).toFixed(2)} N·m</b><br>
        Peso total del poste: <b>${peso.toFixed(2)} kg</b><br>
        Deflexión en punta: <b>${deflexion.toFixed(4)} m</b><br><br>
        Verificación instalación: ${condicionOK ? "✅ Aprobado" : mensajeVerificacion}
    `;
}

</script>
</body>
</html>
