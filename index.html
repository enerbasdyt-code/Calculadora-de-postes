<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calculadora de Postes</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width:900px; }
    h2 { margin-top:25px; }
    .tramo { border:1px solid #ccc; padding:10px; margin:5px 0; display:flex; gap:10px; align-items:center; }
    .tramo input { width:80px; }
    .small-btn { padding:3px 8px; font-size:11px; cursor:pointer; }
    table { border-collapse: collapse; margin-top:20px; width:100%; }
    table, th, td { border:1px solid #aaa; padding:6px; text-align:center; }
    .resultado { background:#eef; padding:10px; margin-top:20px; font-size:18px; }
</style>
</head>
<body>

<h1>Calculadora de Postes de Acero SCH40</h1>

<h2>1. Selección de Tramos</h2>
<button onclick="agregarTramo()">Agregar Tramo</button>
<div id="tramos"></div>

<h2>2. Datos generales</h2>
<label>Altura sobre el terreno (m): </label>
<input id="alturaTerreno" type="number" step="0.1" value="0"><br><br>

<label>Ubicación (Departamento): </label>
<select id="ubicacion"></select><br><br>

<label>Velocidad según E020 Cargas (m/s): </label>
<input id="vBase" type="number" readonly><br><br>

<label>Alpha (rugosidad E.020): </label>
<select id="alpha">
    <option value="0.14">α = 0.14 – Desierto, mar, aeropuerto (A-Muy abierto, costa)</option>
    <option value="0.16">α = 0.16 – Campo, subirbio disperso (B-Abierto con poca obstrucción)</option>
    <option value="0.22">α = 0.22 – Edificaciones medianas, árboles (C-Suburbano/industrial)</option>
    <option value="0.3">α = 0.3 – Centro de ciudad (D-Urbano/denso)</option>
</select><br><br>

<h2>3. Datos de la manga de viento</h2>
<label>Diámetro (pulgadas): </label>
<select id="diamManga">
    <option value="8">8"</option>
    <option value="13">13"</option>
    <option value="18">18"</option>
    <option value="20">20"</option>
    <option value="24">24"</option>
    <option value="36">36"</option>
</select><br><br>

<label>Longitud (pulgadas): </label>
<input id="longManga" type="number"><br><br>

<label>Tipo de soporte: </label>
<select id="tipoSoporte">
    <option value="aro">Aro</option>
    <option value="canastilla">Canastilla extendida</option>
</select><br><br>

<h2>4. Seguridad</h2>
<label>Factor de seguridad: </label>
<input id="fs" type="number" step="0.1" value="1.5"><br><br>

<button onclick="calcular()">Calcular</button>

<div id="resultados" class="resultado"></div>

<h2>Tabla de criterios de deflexión</h2>
<table>
    <tr><th>Criterio</th><th>Valor</th><th>Clasificación</th></tr>
    <tr><td>L/300</td><td id="l300"></td><td>Rígido</td></tr>
    <tr><td>L/200</td><td id="l200"></td><td>Estable</td></tr>
    <tr><td>L/150</td><td id="l150"></td><td>Semi-Flexible</td></tr>
    <tr><td>L/125</td><td id="l125"></td><td>Flexible</td></tr>
    <tr><td>L/100</td><td id="l100"></td><td>Muy Flexible</td></tr>
</table>

<script>
// =========================
// 1) Velocidades por departamento (EDITABLE por ti)
// =========================
const velocidades = {
    Amazonas: 28, Áncash: 30, Apurímac: 26, Arequipa: 34, Ayacucho: 27, Cajamarca: 29,
    Callao: 32, Cusco: 33, Huancavelica: 25, Huánuco: 28, Ica: 36, Junín: 30,
    La_Libertad: 32, Lambayeque: 35, Lima: 33, Loreto: 26, Madre_de_Dios: 24,
    Moquegua: 34, Pasco: 29, Piura: 36, Puno: 31, San_Martín: 26, Tacna: 35,
    Tumbes: 37, Ucayali: 25
};

// Cargar departamentos al menú
const selectDep = document.getElementById("ubicacion");
for(let d in velocidades){
    let opt = document.createElement("option");
    opt.value = d;
    opt.textContent = d.replace(/_/g," ");
    selectDep.appendChild(opt);
}

function actualizarVbase(){
    document.getElementById('vBase').value = velocidades[document.getElementById('ubicacion').value];
}
selectDep.addEventListener('change', actualizarVbase);
actualizarVbase();

// =========================
// 2) Propiedades de tubos SCH40 (DIÁMETRO EXTERIOR E INTERIOR reales)
// OD = diámetro externo (m)
// ID = diámetro interno (m)
// peso aproximado (kg/m)
// =========================
const sch40 = {
    1: { OD: 0.0334, ID: 0.0276, peso: 2.64 },
    2: { OD: 0.0603, ID: 0.0525, peso: 5.44 },
    3: { OD: 0.0889, ID: 0.0807, peso: 8.84 },
    4: { OD: 0.1143, ID: 0.1023, peso: 12.5 }
};

// =========================
// 3) Añadir tramos
// =========================
function agregarTramo(){
    const cont = document.getElementById("tramos");
    const div = document.createElement("div");
    div.className = "tramo";

    div.innerHTML = `
        <label>Ø ("):</label>
        <select class="diametro">
            <option value="1">1"</option>
            <option value="2">2"</option>
            <option value="3">3"</option>
            <option value="4">4"</option>
        </select>
        <label>Long (m):</label>
        <input class="longitud" type="number" step="0.1">
        <button class="small-btn" onclick="this.parentElement.remove()">X</button>
    `;
    cont.appendChild(div);
}

// =========================
// 4) Cálculo principal
// =========================
function calcular(){

    // ---- Recorrer tramos
    const tramos = document.querySelectorAll(".tramo");
    let alturaPoste = 0;
    let pesoPoste = 0;
    let Iequiv = 0;

    tramos.forEach(t=>{
        const d = Number(t.querySelector('.diametro').value);
        const L = Number(t.querySelector('.longitud').value);

        alturaPoste += L;
        pesoPoste += sch40[d].peso * L;

        // Momento de inercia real del tubo: I = π/64*(OD^4 - ID^4)
        const I = (Math.PI/64) * (Math.pow(sch40[d].OD,4) - Math.pow(sch40[d].ID,4));

        // Promedio ponderado según longitud aportada
        Iequiv += I * (L/alturaPoste);
    });

    const alturaTerr = Number(document.getElementById("alturaTerreno").value);
    const hTotal = alturaPoste + alturaTerr;

    // ---- Viento
    const v10 = Number(document.getElementById('vBase').value);
    const alpha = Number(document.getElementById('alpha').value);

    // E.020: V(h)= V10*(h/10)^alpha
    const vH = v10 * Math.pow((hTotal/10), alpha);
    const vKh = (vH * 3.6).toFixed(1);

    // ---- Área proyectada manga
    const diamPul = Number(document.getElementById("diamManga").value);
    const longPul = Number(document.getElementById("longManga").value);
    const Dm = diamPul * 0.0254;
    const Lm = longPul * 0.0254;
    const A = math.pow(Dm,2)*(Math.PI/4);

    const fs = Number(document.getElementById("fs").value);
    const rho = 1.225;
    const fuerza = 0.5 * rho * Math.pow(vH,2) * A * fs;

    const momento = fuerza * hTotal;

    // ---- Deflexión precisa usando expresión polinomial de viga empotrada y carga puntual en la punta:
    // δ = F * L^3 / (3 * E * I)
    const E = 200e9;
    const delta = (fuerza * Math.pow(alturaPoste,3)) / (3 * E * Iequiv);
    const delta_mm = (delta * 1000).toFixed(2);

    // ---- Tabla L/X
    document.getElementById('l300').textContent = (alturaPoste/300).toFixed(3) + " m";
    document.getElementById('l200').textContent = (alturaPoste/200).toFixed(3) + " m";
    document.getElementById('l150').textContent = (alturaPoste/150).toFixed(3) + " m";
    document.getElementById('l125').textContent = (alturaPoste/125).toFixed(3) + " m";
    document.getElementById('l100').textContent = (alturaPoste/100).toFixed(3) + " m";

    document.getElementById('resultados').innerHTML =
        `Altura total: <b>${hTotal.toFixed(2)} m</b><br>`+
        `Velocidad según E020: <b>${v10} m/s</b><br>`+
        `Velocidad a altura del poste: <b>${vH.toFixed(2)} m/s</b> (${vKh} km/h)<br>`+
        `Fuerza sobre manga: <b>${fuerza.toFixed(2)} N</b><br>`+
        `Momento en la base: <b>${momento.toFixed(2)} N·m</b><br>`+
        `Peso total del poste: <b>${pesoPoste.toFixed(2)} kg</b><br>`+
        `Deflexión estimada en la punta: <b>${delta_mm} mm</b>`;
}
</script>
